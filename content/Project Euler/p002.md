Title: Project Euler problem 2 - Even Fibonacci numbers
Date: 2018-07-09 12:30
Category: Project Euler
Tags: fibonacci numbers, project euler, python
related_posts: 
Slug: project-euler-problem-2
Authors: Søren
Summary: Solution to the second Project Euler problem. Calculating the sum of even Fibonacci numbers.

[Link to problem on Project Euler homepage](https://projecteuler.net/problem=2)

[Link to Github repository](https://github.com/fractalleaf/project-euler/tree/master/p002)

## Description

Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:

$$1, 2, 3, 5, 8, 13, 21, 34, 55, 89, \ldots$$

By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.

## Brute force solution
The Fibonacci sequence is defined by the recurrence relation

$$F_n = F_{n-2} + F_{n-1}$$

with seed values $F_1 = 1$ and $F_2 = 1$.

A brute force solution to the problem can be obtained by simply generating all Fibonacci numbers below four million, and testing for even values.


```python
LIMIT = 4*10**6

def p002_brute_force():
    """Brute-force solution"""
    f_nm2, f_nm1 = 1, 1

    total = 0
    while f_nm1 < LIMIT:
        if f_nm1 % 2 == 0:
            total += f_nm1

        f_nm2, f_nm1 = f_nm1, f_nm2+f_nm1

    return total

%timeit p002_brute_force()
```

    3.45 µs ± 78.2 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)


## Avoid generating odd Fibonacci numbers

The most obvious improvement to the algorithm is to simply avoid generating the odd Fibonacci numbers. This will both reduce the number of iterations, and remove the need to test for even values.

By generating the first 12 Fibonacci numbers, it quicly becomes clear that every third Fibonacci number is even ($F_3$, $F_6$, $F_9$, $\ldots$).

| $F_1$ | $F_2$ | $F_3$ | $F_4$ | $F_5$ | $F_6$ | $F_7$ | $F_8$ | $F_9$ | $F_{10}$ | $F_{11}$ | $F_{12}$ |
|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:--------:|:--------:|:--------:|
| 1     | 1     | 2     | 3     | 5     | 8     | 13    | 21    | 34    | 55       | 89       | 144      |

It is possible manipulate the Fibonacci recurrence relation to only include every third value

$$ \begin{eqnarray}
       F_n &=& F_{n-2} + F_{n-1} \\
           &=& F_{n-4} + F_{n-3} + F_{n-3} + F_{n-2} \\
           &=& F_{n-4} + 2 \times F_{n-3} + F_{n-2} \\
           &=& F_{n-4} + 2 \times F_{n-3} + F_{n-4} + F_{n-3} \\
           &=& 2 \times F_{n-4} + 3 \times F_{n-3} \\
           &=& F_{n-6} + F_{n-5} + F_{n-4} + 3 \times F_{n-3} \\
           &=& F_{n-6} + 4 \times F_{n-3}. \\
   \end{eqnarray}
$$

Relabelling yields a new recurrence relation for the even Fibonacci numbers: $E_n = E_{n-2} + 4 \times E_{n-1}$, with seed values $E_1 = 2$ and $E_2 = 8$.


```python
def p002_even_recurrence():
    """Even recurrence solution"""
    e_nm2, e_nm1 = 2, 8

    total = 2
    while e_nm1 < LIMIT:
        total += e_nm1

        e_nm2, e_nm1 = e_nm1, 4*e_nm1 + e_nm2

    return total

%timeit p002_even_recurrence()
```

    1.22 µs ± 30.3 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)


The even recurrence relation outperforms the normal recurrence relation by roughly a factor of three. This seems reasonable considering that the number of iterations have been reduced by the same factor.
